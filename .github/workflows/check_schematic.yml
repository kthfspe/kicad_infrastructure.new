on:
  workflow_call:   # ðŸ‘ˆ makes it reusable
jobs:
  check_schematic_values:
    name: Check schematic values
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Checkout kicad infrastructure repository
        uses: actions/checkout@v6
        with:
          repository: kthfspe/kicad_infrastructure.new
          path: kicad_infrastructure
      - name: Install dependencies
        run: |
          python -m venv venv
          ./venv/bin/activate
          pip install -r kicad_infrastructure/scripts/requirements.txt

      - name: Run schematic value checks for each schematic file
        run: |
          cd kicad
          for file in $(find . -name "*.kicad_sch"); do
            echo "Checking schematic file: $file"
            python3 ../kicad_infrastructure/scripts/check_schematic.py -s "$file" -c v
          done

      - name: Schematic value check completed
        run: echo "Schematic value checks completed."

  check_schematic_part_numbers:
    name: Check schematic part numbers
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Checkout kicad infrastructure repository
        uses: actions/checkout@v6
        with:
          repository: kthfspe/kicad_infrastructure.new
          path: kicad_infrastructure
      - name: Install dependencies
        run: |
          python -m venv venv
          ./venv/bin/activate
          pip install -r kicad_infrastructure/scripts/requirements.txt

      - name: Run schematic value checks for each schematic file
        run: |
          cd kicad
          for file in $(find . -name "*.kicad_sch"); do
            echo "Checking schematic file: $file"
            python3 ../kicad_infrastructure/scripts/check_schematic.py -s "$file" -c p
          done

      - name: Schematic value check completed
        run: echo "Schematic value checks completed."

  check_schematic_todos:
    name: Check schematic TODOs
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Checkout kicad infrastructure repository
        uses: actions/checkout@v6
        with:
          repository: kthfspe/kicad_infrastructure.new
          path: kicad_infrastructure
      - name: Install dependencies
        run: |
          python -m venv venv
          ./venv/bin/activate
          pip install -r kicad_infrastructure/scripts/requirements.txt
      - name: Run schematic TODO checks for each schematic file
        run: |
          cd kicad
          for file in $(find . -name "*.kicad_sch"); do
            echo "Checking schematic file: $file"
            python3 ../kicad_infrastructure/scripts/check_schematic.py -s "$file" -c t
          done
      - name: Schematic TODO check completed
        run: echo "Schematic TODO checks completed."

  check_standard_parts:
    name: Check standard parts
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Checkout kicad infrastructure repository
        uses: actions/checkout@v6
        with:
          repository: kthfspe/kicad_infrastructure.new
          path: kicad_infrastructure
      - name: Install dependencies
        run: |
          python -m venv venv
          ./venv/bin/activate
          pip install -r kicad_infrastructure/scripts/requirements.txt
      - name: Download standard parts excel
        run: curl -o standard_parts.xlsx -L 'https://docs.google.com/spreadsheets/d/1B5yTU8hbspwpGbjGXaKnibLVT2mXyAeF2e9IzwK99WI/export?exportFormat=xlsx'
      - name: Run standard parts checks for each schematic file
        run: |
          cd kicad
          for file in $(find . -name "*.kicad_sch"); do
            echo "Checking schematic file: $file"
            python3 ../kicad_infrastructure/scripts/check_schematic.py -s "$file" -c s -x ../standard_parts.xlsx
          done
      - name: Standard parts check completed
        run: echo "Standard parts checks completed."

  check_kicad_version:
    name: Check KiCad version
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Checkout kicad infrastructure repository
        uses: actions/checkout@v6
        with:
          repository: kthfspe/kicad_infrastructure.new
          path: kicad_infrastructure
      - name: Install dependencies
        run: |
          python -m venv venv
          ./venv/bin/activate
          pip install -r kicad_infrastructure/scripts/requirements.txt
      - name: Run KiCad version checks for each schematic file
        run: |
          cd kicad
          for file in $(find . -name "*.kicad_sch"); do
            echo "Checking schematic file: $file"
            python3 ../kicad_infrastructure/scripts/check_schematic.py -s "$file" -c k
          done
      - name: KiCad version check completed
        run: echo "KiCad version checks completed."

